---
title: "Statistics Project"
output: html_notebook
---

# ANALYSIS 1 

## Restatement of the Problem 
Estimate how SalesPrice of the house is related to the square footage of the living area of the house & if SalesPrice (and its relationship to square footage) depends on which neighborhood the house is located in. We are only interested at looking at houses in the NAmes, Edwards & BrkSide neighborhoods. 

## Packages
```{r}
library(dplyr)
library(readr)
library(tidyverse)
```

## Read in data
```{r}
train <- read.csv("train.csv", header=TRUE, stringsAsFactors=TRUE)
test <- read.csv("test.csv", header=TRUE, stringsAsFactors=TRUE)

head(train)
head(test)
```
## Filter data on neighborhoods 
```{r}
train_a1 <- dplyr::filter(train,Neighborhood =="Edwards" | Neighborhood =="NAmes" | Neighborhood == "BrkSide")
test_a1 <- dplyr::filter(test,Neighborhood =="Edwards" | Neighborhood =="NAmes" | Neighborhood == "BrkSide")

head(train_a1)
head(test_a1)
```
## Summary Statistics
```{r}
summary(train_a1)
summary(test_a1)

str(train_a1)
```
## EDA 

From an initial examination of the scatter plots and histograms, 

```{r}
train_a1 %>% ggplot(aes(x = (GrLivArea), y = SalePrice/1000, color = Neighborhood)) + geom_point() + stat_smooth(method = "lm")

train_a1 %>% ggplot(aes(x = SalePrice/10000, fill = Neighborhood)) + geom_histogram(bins =20)

train_a1 %>% ggplot(aes(x = GrLivArea, fill = Neighborhood)) + geom_histogram(bins =20)
```
## Log Transforms 
```{r}
# histograms with log transform on each individual variables
train_a1 %>% ggplot(aes(x = log(SalePrice/10000), fill = Neighborhood)) + geom_histogram(bins =20)

train_a1 %>% ggplot(aes(x = log(GrLivArea), fill = Neighborhood)) + geom_histogram(bins =20)

train_a1 %>% ggplot(aes(x = log(GrLivArea), y = SalePrice/1000, color = Neighborhood)) + geom_point() + stat_smooth(method = "lm")

train_a1 %>% ggplot(aes(x = (GrLivArea), y = log(SalePrice/1000), color = Neighborhood)) + geom_point() + stat_smooth(method = "lm")

train_a1 %>% ggplot(aes(x = log(GrLivArea), y = log(SalePrice/1000), color = Neighborhood)) + geom_point() + stat_smooth(method = "lm")
```

## Linear Model 

From a visual inspection of the Cook's D and residual plot, we notice there are 3 outliers: 
```{r}
fit1 <- lm(log(SalePrice) ~ log(GrLivArea) + Neighborhood + GrLivArea*Neighborhood, data = train_a1)
summary(fit1)
confint(fit1)

plot(fit1)

hist(fit1$residuals, col = "blue", main = "Histogram of Residuals")
plot(fit1$fitted.values,fit1$residuals, main = "Plot of Residuals v. Fitted Values")
sqrt(mean(fit1$residuals^2)) #RMSE
```
```{r}

```

## ANOVA 
```{r}
res.aov <- aov(log(SalePrice)~log(GrLivArea)+Neighborhood+Neighborhood*GrLivArea, data = train_a1)
summary(res.aov)
```
```{r}
library(car)
# QQPlot
qqPlot(log(train_a1$SalePrice))

# histogram of residuals 
h <- hist(fit1$residuals, breaks = 10, density = 10,col = "lightgray",main = "Residuals") 
xfit <- seq(min(fit1$residuals), max(fit1$residuals), length = 40) 
yfit <- dnorm(xfit, mean = mean(fit1$residuals), sd = sd(fit1$residuals)) 
yfit <- yfit * diff(h$mids[1:2]) * length(fit1$residuals) 
```


##remove outliers
```{r}

```

# ANALYSIS 2: MODELS 

## EDA
```{r}
str(train)
summary(train)
```
##
### Missing data & Duplicates
- NA means something in following: Alley, BsmtQual, BsmtCond, BsmtExposure, BsmtFinType1,BsmtFinType2, FireplaceQu, GarageType, GarageFinish, GarageQual, GarageCond, PoolQC, Fence, MiscFeature
- Electrical has NAs but seems important? 
```{r}
colSums(is.na(train)) != 0

# remove columns with NAs that have no meaning (from data description)
train_clean = subset(train, select= -c(LotFrontage,MasVnrType, MasVnrArea))

```


```{r}
train[duplicated(train),]

```
## Look at distribution of SalePrice &  LotArea

## Replace N/A 
```{r}

train_clean[is.na(train_clean)] = "None"
summary(train_clean )
```

##  Feature Selection 
```{r}
library(caret)
# Feature Selection
# We need to find features which are important for the model.

# Setting Seed to ensure results are repeatable.
set.seed(7)

# prepare training scheme
control <- trainControl(method="repeatedcv", number=10, repeats=3)
# train the model 
model <- train(SalePrice~., data=train, method="lvq", preProcess="scale", trControl=control)
# estimate variable importance
importance <- varImp(model, scale=FALSE)
# summarize importance
print(importance)
# plot importance
plot(importance)
```
## Create Model 
```{r}
fit2 = lm(SalePrice~LotArea , data= train)
summary(fit2)
```


## Forward Selection 

```{r}
library(olsrr)
ols_step_forward_p(fit2, penter = 0.05, details = TRUE)

```



## Backwards Elimination 
```{r}
ols_step_backward_p(fit, prem = 0.05, details = TRUE)

```


## Stepwise Selection 
```{r}
ols_step_both_p(fit, prem = 0.05, pent = 0.05, details = FALSE)

```

## Custom Model 

